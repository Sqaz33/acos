**Соглашение о вызове (Calling Convention) в операционных системах** — это набор правил, определяющих, как функции вызываются и обрабатывают параметры в машинном коде. Оно регулирует:

1. **Как передаются аргументы**
   * Через регистры (например, в x86: `EAX`, `ECX`, `EDX` или в x64: `RCX`, `RDX`, `R8`, `R9`);
   * Через стек (пушинг аргументов в обратном порядке или прямом);
   * Комбинированный способ.
2. **Как происходит возврат значения**
   * Обычно результат возвращается через регистр (например, `EAX`/`RAX` в архитектуре x86/x64).
   * В случае больших структур — через указатель на память.
3. **Кто отвечает за очистку стека**
   * Вызывающая функция (caller-cleanup) или вызываемая (callee-cleanup).
4. **Какие регистры должны сохраняться**
   * Caller-saved (вызывающая функция отвечает за сохранение важных данных);
   * Callee-saved (вызываемая функция обязана восстанавливать значения).

### Основные соглашения о вызовах в разных архитектурах

#### **x86 (32-bit)**

1. **cdecl (C declaration)**
   * Аргументы передаются справа налево через стек.
   * Очищает стек вызывающая функция.
   * Используется в языках C/C++.
2. **stdcall (Standard Calling Convention)**
   * Аргументы передаются справа налево через стек.
   * Очищает стек вызываемая функция.
   * Используется в Windows API.
3. **fastcall**
   * Первые два аргумента передаются через регистры `ECX` и `EDX`.
   * Остальные — через стек.
   * Очищает стек вызываемая функция.
4. **thiscall**
   * Используется для вызова методов класса в C++.
   * Указатель `this` передается через `ECX`.

---

#### **x86-64 (64-bit)**

1. **Microsoft x64 Calling Convention**
   * Первые 4 параметра передаются через регистры `RCX`, `RDX`, `R8`, `R9`.
   * Остальные — через стек.
   * Вызывающая функция отвечает за очистку.
2. **System V AMD64 ABI (Linux/macOS)**
   * Первые 6 аргументов передаются через регистры `RDI`, `RSI`, `RDX`, `RCX`, `R8`, `R9`.
   * Остальные — через стек.

---

#### **ARM (32-bit и 64-bit)**

1. **AAPCS (ARM Architecture Procedure Call Standard)**
   * Первые 4 аргумента передаются через регистры `R0-R3`.
   * Остальные — через стек.
   * Используется в Linux, Android и iOS.

---

### Примеры использования

* При написании кода на ассемблере важно учитывать соглашения вызовов для совместимости с C/C++ кодом.
* При разработке низкоуровневых библиотек и драйверов для ОС Windows и Linux.
* Оптимизация производительности программ за счет минимизации накладных расходов при передаче параметров.
