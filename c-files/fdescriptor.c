/*
    Файловый дескриптор (File Descriptor, FD) — это целочисленный идентификатор,
    который операционная система UNIX/Linux использует для управления открытыми
    файлами или другими ресурсами, связанными с вводом-выводом (например,
    сокетами, каналами, терминалами и устройствами).

    Основные свойства файловых дескрипторов
    Целочисленный идентификатор:

    Дескриптор представляет собой небольшое целое число, которое ОС использует как
    ссылку на внутренние структуры данных, связанные с открытым файлом. Дескрипторы
    уникальны в пределах одного процесса. Назначение:

    Файловый дескриптор используется процессами для выполнения операций
    ввода-вывода, таких как чтение (read()), запись (write()) или управление
    ресурсами (close(), lseek()). Связь с таблицей файлов:

    Каждый процесс имеет таблицу открытых файлов (file descriptor table). Она
    содержит записи, которые указывают на системные структуры данных, хранящие
    информацию о файле (например, путь, текущую позицию, права доступа).

    При запуске программы в UNIX/Linux ей автоматически предоставляются 
    три стандартных файловых дескриптора:
    FD	Имя	    Назначение
    0	stdin	Стандартный ввод (например, клавиатура)
    1	stdout	Стандартный вывод (например, экран)
    2	stderr	Стандартный вывод ошибок

    
*/

#include <unistd.h>
#include <fcntl.h>
#include <stdio.h>

int main() {
    int fd = open("example.txt", O_RDONLY); // Открываем файл для чтения
    if (fd == -1) {
        perror("open"); // Ошибка открытия
        return 1;
    }

    char buffer[128];
    ssize_t bytes_read = read(fd, buffer, sizeof(buffer)); // Читаем из файла
    write(1, buffer, bytes_read); // Пишем в stdout (FD=1)
    close(fd); // Закрываем дескриптор файла
    return 0;

    /*
        Дубликаты дескрипторов:

        Можно создавать копии файловых дескрипторов с помощью системного вызова dup()
        или dup2(), что позволяет перенаправлять вывод или ввод. Пример
        перенаправления
    */

    fd = open("output.txt", O_WRONLY | O_CREAT, 0644);
    dup2(fd, 1); // Перенаправить stdout в файл
    printf("Это попадет в файл\n");
    close(fd);
}
